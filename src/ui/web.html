<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Websocket Client</title><link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous"><style>p{margin-bottom:0}.small{font-size:.75rem}#app{max-height:500px}#event-log,#output-log{height:500px;overflow-y:scroll;border:1px solid #aaa;background:#eee}#output-log p{word-wrap:break-word;color:#aaa}#output-log p:last-child{color:#5f5feb;font-weight:700}</style></head><body><div class="container py-4 px-5"><div class="row"><div class="col d-flex align-items-center gap-3"><h3>PSMonitor -<span class="text-muted">Web Dashboard</span></h3></div></div><div class="row"><div class="col-8 border-end"><h4 class="fw-normal">Websocket Data</h4><hr><div class="row mt-1 small"><div class="col"><p class="lead">CPU:</p><p>Temperature:<span id="cpu-temp">--</span>C</p><p>Usage:<span id="cpu-usage">--</span>%</p><p>Frequency:<span id="cpu-freq">--</span>MHz</p></div><div class="col"><p class="lead">RAM:</p><p>Used:<span id="mem-used">--</span>GB</p><p>Free:<span id="mem-free">--</span>GB</p><p>Total:<span id="mem-total">--</span>GB</p><p>Percent:<span id="mem-percent">--</span>%</p></div><div class="col"><p class="lead">Disk:</p><p>Used:<span id="disk-used">--</span>GB</p><p>Free:<span id="disk-free">--</span>GB</p><p>Total:<span id="disk-total">--</span>GB</p><p>Percent:<span id="disk-percent">--</span>%</p></div></div></div><div class="col-4"><h4 class="fw-normal">HTTP Data</h4><hr><div class="row mt-1 small"><div class="col-md-6"><p class="lead mb-2">Interfaces:</p><div id="net-interfaces"><p class="text-secondary"><em>Request `/network` endpoint to display data...</em></p></div></div><div class="col-md-6"><p class="lead mb-2">Wifi:</p><p>Name:<span id="wifi-name">--</span></p><p>Quality:<span id="wifi-quality">--</span></p><p>Channel:<span id="wifi-channel">--</span></p><p>Encryption:<span id="wifi-encryption">--</span></p><p>Address:<span id="wifi-address">--</span></p><p>Signal:<span id="wifi-signal">--</span></p></div></div></div></div><hr><div class="d-flex align-items-center justify-content-start gap-5"><div class="me-5"><p class="lead">Websocket Connection</p><div class="row mt-1"><div class="col d-flex justify-content-start align-items-center gap-3"><button class="btn btn-sm btn-outline-success" id="endpoint-open">Open</button><button class="btn btn-sm btn-outline-danger" id="endpoint-close">Close</button></div></div></div><div class="me-5"><p class="lead">HTTP Endpoints</p><div class="row mt-1"><div class="col d-flex justify-content-start align-items-center gap-3"><button class="btn btn-sm btn-outline-success" id="endpoint-system">GET /system: Fetch system data</button><button class="btn btn-sm btn-outline-success" id="endpoint-network">GET /network: Fetch network data</button></div></div></div><div><p class="lead">Output Messages</p><div class="row mt-1"><div class="col d-flex justify-content-start align-items-center gap-3"><button class="btn btn-sm btn-outline-danger" id="output-clear">Clear</button></div></div></div></div><hr><p class="lead mt-3">Log Output</p><div class="row mt-3"><div class="col-4"><p class="lead mb-2">Events:</p><div id="event-log" class="font-monospace small"></div></div><div class="col-8"><p class="lead mb-2">Messages:</p><div id="output-log" class="flex-fill font-monospace small"></div></div></div></div><script>function time(){const e=new Date;return("0"+e.getHours()).slice(-2)+":"+("0"+e.getMinutes()).slice(-2)+":"+("0"+e.getSeconds()).slice(-2)}document.addEventListener("DOMContentLoaded",(()=>{const e={event:document.querySelector("#event-log"),output:document.querySelector("#output-log"),write:(t,n)=>{const o=document.createElement("p");o.innerText=`[${time()}] ${n}`,e[t].append(o),e[t].scrollTop=e[t].scrollHeight},clear:()=>{e.output.innerHTML="",e.write("event","Output messages cleared")}},t={cpu:{temp:document.querySelector("#cpu-temp"),usage:document.querySelector("#cpu-usage"),freq:document.querySelector("#cpu-freq")},mem:{used:document.querySelector("#mem-used"),free:document.querySelector("#mem-free"),total:document.querySelector("#mem-total"),percent:document.querySelector("#mem-percent")},disk:{used:document.querySelector("#disk-used"),free:document.querySelector("#disk-free"),total:document.querySelector("#disk-total"),percent:document.querySelector("#disk-percent")},set:(e,n,o)=>{t[e]&&Object.prototype.hasOwnProperty.call(t[e],n)&&(t[e][n].innerText=o)}},n={name:document.querySelector("#wifi-name"),quality:document.querySelector("#wifi-quality"),channel:document.querySelector("#wifi-channel"),encryption:document.querySelector("#wifi-encryption"),address:document.querySelector("#wifi-address"),signal:document.querySelector("#wifi-signal"),set:(e,t)=>{n[e]&&(n[e].innerText=t)}};document.querySelector("#endpoint-network").addEventListener("click",(()=>{fetch("http://localhost:4500/network").then((e=>e.json())).then((t=>{for(const e in n)n.set(e,t.wireless[e]);const{interfaces:o}=t,c=document.querySelector("#net-interfaces");if(c)for(inet of(c.innerHTML="",o)){const e=document.createElement("p");e.innerHTML=inet,c.appendChild(e)}e.write("event","Fetched network information from HTTP network/ endpoint"),e.write("output",JSON.stringify(t)+"\n\n")})).catch((()=>{e.write("event","ERROR! Unable to fetch network information from the HTTP network/ endpoint")}))})),document.querySelector("#endpoint-system").addEventListener("click",(()=>{fetch("http://localhost:4500/system").then((e=>e.json())).then((n=>{for(const e in n.cpu)t.set("cpu",e,n.cpu[e]);for(const e in n.mem)t.set("mem",e,n.mem[e]);for(const e in n.disk)t.set("disk",e,n.disk[e]);e.write("event","Fetched system information from HTTP system/ endpoint"),e.write("output",JSON.stringify(n)+"\n\n")})).catch((t=>{console.log(t),e.write("event","ERROR! Unable to fetch system information from the HTTP system/ endpoint")}))}));let o=null;document.querySelector("#endpoint-open").addEventListener("click",(async()=>{e.write("event","Connecting to websocket");const n=await fetch(location.pathname,{method:"POST",body:{connection:"monitor"}}),c=await n.json();e.write("event",`Created worker (${c.id})`);const r=`ws://localhost:4500/connect?id=${c.id}`;o=o??new WebSocket(r),o.onopen=()=>{e.write("event","Websocket is connected"),e.write("event","Receiving data...")},o.onmessage=n=>{e.write("output",n.data+"\n\n");try{const e=JSON.parse(n.data);for(const n in e.cpu)t.set("cpu",n,e.cpu[n]);for(const n in e.mem)t.set("mem",n,e.mem[n]);for(const n in e.disk)t.set("disk",n,e.disk[n])}catch(e){}},o.onclose=t=>{e.write("event","Websocket connection closed"),o=null}})),document.querySelector("#endpoint-close").addEventListener("click",(()=>{o&&(e.write("event","Closing websocket connection"),window.conn=o,o.close())})),document.querySelector("#output-clear").addEventListener("click",e.clear)}));</script></body></html>